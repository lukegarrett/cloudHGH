---
#
# EECS 4287/5287: Principles of Cloud Computing
# Author: Aniruddha Gokhale
# Created: Fall 2020
# Modified: Fall 2020  to use new approach
#
# This playbook will execute a command on the remote machine
# Horizon Cloud VM or Chameleon VMs or AWS VMs
# See https://docs.ansible.com/ansible/latest/collections/ansible/builtin/command_module.html
- hosts: MyChameleonVMs
  remote_user:  cc   # change the user to whatever is the user on the cloud VM
  collections:   # this is new starting with Ansible 2.9 (akin to importing package)
    - openstack.cloud
  become: yes

  # here we use the command module. There is also the shell module to do similar
  # outcome especially when you want to run a shell script, and there are more
  # complex arguments including executing in specific directories.
  tasks:
          # - name: Clone Producer/Consumer Code
          # shell: "git clone https://github.com/lukegarrett/cloudHGH.git"

    - name: Enable CouchDB Repository 01
      shell: "curl -L https://couchdb.apache.org/repo/bintray-pubkey.asc | sudo apt-key add "

    - name: Enable CouchDB Repository 02
      shell: "echo "deb https://apache.bintray.com/couchdb-deb focal main" | sudo tee -a /etc/apt/sources.list"

    - name: Enable CouchDB Repository 03
      shell: "curl https://couchdb.apache.org/repo/keys.asc | gpg --dearmor | sudo tee /usr/share/keyrings/couchdb-archive-keyring.gpg >/dev/null 2>&1
			source /etc/os-release"

    - name: Apt-Update
      shell: "sudo apt update"

    - name: Install CouchDB
      shell: "sudo apt install couchdb"

...
